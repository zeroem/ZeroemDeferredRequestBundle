services:
  defer_request_annotation_driver:
    class: Zeroem\DeferredRequestBundle\Annotation\Driver\AnnotationDriver
    tags: [{name: kernel.event_listener, event: kernel.controller, method: onKernelController}]
    arguments:
      - @annotation_reader
      - @event_dispatcher
      - @defer_request_persister
      - @defer_response_builder

  defer_response_builder:
    class: Zeroem\DeferredRequestBundle\Response\ResponseBuilder
    arguments: [@router]

  defer_request_persister:
    class: Zeroem\DeferredRequestBundle\Persistence\Entity
    arguments: [@doctrine.orm.default_entity_manager]